# Neco Weekly (2022-09-08号)

サイボウズ Neco チームでは、 Neco Weekly という「最近気になる Cloud Native 関連のネタを共有する会」を社内で開催しています。
本記事は共有会の中で紹介したネタをまとめたものです。

今回は第7回目の記事となります。

## ✨ News

### サイボウズサマーインターン2022 報告 〜 Kubernetes基盤開発コース&ストレージコース

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://blog.cybozu.io/entry/2022/09/07/135414">サイボウズサマーインターン2022 報告 〜 Kubernetes基盤開発コース&ストレージコース - Cybozu Inside Out | サイボウズエンジニアのブログ</a></h4><p>こんにちは、Necoチームの 鎌田、 阪上、そしてストレージチームの 大神、 sat です。 サイボウズは毎年サマーインターンシップを開催しています。 2022年度のサマーインターンシップ もさまざまなコースを用意しました。本記事では8月22日～9月2日の10日間にわたって開催された、Kubernetes基盤開発コース、およびストレージコースの模様をお届けいたします。 ...</p></blockquote>

Necoチームとストレージチームにて、2週間のサマーインターンを実施しました。
今年もかなり面白い経験をしてもらえたのではないかと思います。

### 技術文書の書き方

弊チームの若手メンバー向けに技術文書の書き方勉強会を実施しました。
以下は勉強会で利用した資料です。

- [技術文書の書き方](https://gist.github.com/ymmt2005/d2c152bb7179d07015f336b1a0582679)

勉強会の中では以下のような質疑応答がありました。

- ランダムメモを書く際の「難しい」の基準は？ 
    - 自分が難しいと思ったものについて書けば良い。
- 書いてはいけないドキュメントはある？
    - メンテナンスさえできていれば、基本的には書いていけないものはほとんどない。
- 文書のメンテナンスは誰がやるべき？
    - ソースコードを変更する際に同じPRでドキュメントも直すべき。ソースコードを書き換えた人がドキュメントも修正する。ドキュメントの修正ができてない場合はレビューで指摘する。
    - ソースコードへの依存が強いドキュメントはメンテが大変なので、できるだけ自動生成に頼る。メンテが難しいものはドキュメントを書かない。
- 新しいソフトウェアを理解するときはどこから読めばいい？
    - まずはアーキテクチャから理解するのがよい。
- アーキテクチャを解説している文書がなかったら？
    - 今後ソフトウェアのメンテをしていく上で必要だと判断したなら、後からでも書けば良い。

また、上記の資料の中では紹介されていませんが、[cobra](https://github.com/spf13/cobra)というCLIツールを開発するためのフレームワークにも、ドキュメントを自動生成する機能があります。

- [Generating Markdown Docs For Your Own cobra.Command](https://github.com/spf13/cobra/blob/main/doc/md_docs.md)

## 👀 Notable Articles

### READYFORのOSSポリシーを公開しました

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://tech.readyfor.jp/entry/2022/09/01/120000">READYFORのOSSポリシーを公開しました - READYFOR Tech Blog</a></h4><p>こんにちは、READYFORでVP of Engineeringをしております、 いとひろ です。 この度、めでたくREADYFORのOSSポリシーをGitHub上で公開しましたので、共有いたします 👏👏👏 READYFORでは、息をするようにOSSにコントリビュートをしている @kotarella1110（React Hook Formコアコントリビュータ）や ...</p></blockquote>

サイボウズ、ZOZOさん、READYFORさんのOSSポリシーの違いを解説している記事です。
著作権の帰属範囲を図示して解説してくれているので非常に分かりやすいですね。

### [Kubernetes 1.25] Alpha: Pod内でのUser Namespaceを試してみた

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://qiita.com/junya19862/items/ca6964baaaaafe603aba">[Kubernetes 1.25] Alpha: Pod内でのUser Namespaceを試してみた - Qiita</a></h4><p>Kubernetes 1.25でAlpha機能ではありますが、PodでのUser Namespaceがサポートされました！ ...</p></blockquote>

[先々週号](../08/2022-08-26.md)でも紹介したKubernetes 1.25の新機能であるUser Namespaceを試している記事です。
実際に手を動かして動作確認してくれている記事は非常にありがたいですね。

### Introducing Ambient Mesh

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://istio.io/latest/blog/2022/introducing-ambient-mesh/">Introducing Ambient Mesh</a></h4><p>Sep 7, 2022 | By John Howard - Google, Ethan J. Jackson - Google, Yuval Kohavi - Solo.io, Idit Levine - Solo.io, Justin Pettit - Google, Lin Sun - Solo.io Today, we are excited to introduce "ambient mesh", a new Istio data plane mode that's designed for simplified operations, broader application compatibility, and reduced infrastructure cost.</p></blockquote>

Istioがサービスメッシュのアーキテクチャとして、Ambient Meshという新しい方式を発表しました。

サービスメッシュのアーキテクチャについては、[2022-07-22号](../07/2022-07-22.md)、[2022-08-05号](../08/2022-08-05.md)でも紹介してきました。
Ciliumはサイドカーフリーの方式を選べるようになり、一方でLinkerdはサイドカー方式がよいと言っています。
今後どうなっていくのか要注目です。

### Kubernetes API Server Bypass Risks

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://kubernetes.io/docs/concepts/security/api-server-bypass-risks/">Kubernetes API Server Bypass Risks</a></h4><p>Security architecture information relating to the API server and other components The Kubernetes API server is the main point of entry to a cluster for external parties (users and services) interacting with it. As part of this role, the API server has several key built-in security controls, such as audit logging and admission controllers.</p></blockquote>

KubernetesのAPI ServerではRBACやAdmission Webhookを利用することで、誰でも自由にリソースを書き換えることはできないようになっています。
しかし、それらをバイパスして攻撃する手段があります。
このブログ記事ではAPI Serverをバイパスする手段と、それを防ぐための方法について解説しています。

Necoチームでは[CKE](https://github.com/cybozu-go/cke)というKubernetesクラスタ構築ツールを自作していますが、上記の記事で紹介されている対策は実施済みなので特に問題なさそうです。

## 🛠️ Tools

### controller-runtime v0.13.0

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://github.com/kubernetes-sigs/controller-runtime/releases/tag/v0.13.0">Release v0.13.0 · kubernetes-sigs/controller-runtime</a></h4><p>changes since v0.12.3 Do not mutate the global warning handler (#1944) Add GetOptions as optional argument of client.Reader and all its implementation (#1917) Bump golangci lint to v1.49.0 (#1988) Update k8s API to v1.25 (#1985) Implement IgnoreAlreadyExists (#1965) Bump k8s v0.25.0-alpha.3 (#1967) webhook: add an option to recover from panics in handler (#1900) Provide access to admission.Request in custom validator/defaulter (#1950) komega: add EqualObject matcher (#1833) fix some typos (#1924) Allow TLS to be entirely configured on webhook server (#1897) Rearange EventBroadcaster log statement.</p></blockquote>

controller-runtime v0.13.0がリリースされました。
個人的には以下の新機能に注目です。

- komega: add EqualObject matcher ([#1833](https://github.com/kubernetes-sigs/controller-runtime/pull/1833))

これは、テストを書くときにKubernetesのオブジェクトを比較するためのMatcherの実装です。
オブジェクトを比較するときに一部のメタデータを無視したり、特定のパスのフィールドのみを比較したりできるようです。

## あとがき

無事サマーインターンが終了し、チームとしても一息つけそうです。
なお、インターンの課題として開発したKubernetesカスタムコントローラに関しては、改めてブログ等で紹介したいと思っています。
