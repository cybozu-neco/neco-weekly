# Neco Weekly (2022-07-22å·)

<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>

ã‚µã‚¤ãƒœã‚¦ã‚º Neco ãƒãƒ¼ãƒ ã§ã¯ã€ Neco Weekly ã¨ã„ã†ã€Œæœ€è¿‘æ°—ã«ãªã‚‹ Cloud Native é–¢é€£ã®ãƒã‚¿ã‚’å…±æœ‰ã™ã‚‹ä¼šã€ã‚’ç¤¾å†…ã§é–‹å‚¬ã—ã¦ã„ã¾ã™ã€‚

ã“ã®å…±æœ‰ä¼šã®ä¸­ã§ç´¹ä»‹ã—ãŸãƒã‚¿ã‚’ã“ã“ã§ç¤¾å¤–ç™ºä¿¡ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

ä»Šå›ã¯ç¬¬1å›ç›®ã®è¨˜äº‹ã¨ãªã‚Šã¾ã™ã€‚

## Neco ãƒãƒ¼ãƒ ã¨ã¯

Neco ãƒãƒ¼ãƒ ã¯ã€ Kubernetes ã‚’ä¸»è¦ãªéƒ¨å“ã¨ã—ã¦ã€è‡ªç¤¾ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ cybozu.com ã‚’é‹ç”¨ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ç®¡ç†åŸºç›¤ã®é–‹ç™ºãŠã‚ˆã³é‹ç”¨ã‚’ãŠã“ãªã£ã¦ã„ã¾ã™ã€‚

ãƒãƒ¼ãƒ ã®å–ã‚Šçµ„ã¿ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ã€ãœã²ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ãã ã•ã„ã€‚

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://github.com/cybozu-neco">cybozu-neco - Overview</a></h4><p>A machine account for Neco. cybozu-neco has 3 repositories available. Follow their code on GitHub.</p></blockquote>

## âœ¨ Release Notes

### Loki v2.6.0 ãƒªãƒªãƒ¼ã‚¹

<blockquote class="embedly-card"><h4><a href="https://github.com/grafana/loki/releases/tag/v2.6.0">Release v2.6.0 Â· grafana/loki</a></h4><p>Query multiple tenants at once. We've introduced cross-tenant query federation, which allows you to issue one query to multiple tenants and get a single, consolidated result. This is great for scenarios where you need a global view of logs within your multi-tenant cluster. For more information on how to enable this feature, see Multi-Tenancy.</p></blockquote>

Loki v2.6.0 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚

ã“ã‚Œã¾ã§ã¯é•·æœŸé–“ã®ãƒ­ã‚°ã‚’æŒ‡å®šã—ãŸã‚¯ã‚¨ãƒªã®å®Ÿè¡Œã«ã¨ã¦ã‚‚æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ãŸã®ã§ã™ãŒã€ã‚¯ã‚¨ãƒªã‚’30åˆ†ã”ã¨ã®å°ã•ãªã‚¯ã‚¨ãƒªã«åˆ†å‰²ã—ã¦ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ãªã‚‹ãã†ã§ã™ã€‚

æ€§èƒ½å‘ä¸ŠãŒæœŸå¾…ã§ããã†ã§ã¨ã¦ã‚‚æ¥½ã—ã¿ã§ã™ã€‚

### Cilium 1.12 ãƒªãƒªãƒ¼ã‚¹

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://isovalent.com/blog/post/cilium-release-112/">Cilium 1.12 - Ingress, Multi-Cluster, Service Mesh, External Workloads, and much more</a></h4><p>Today, we are excited to announce the release of Cilium 1.12. This is yet another massive release. While writing this blog, we have jokingly mentioned that we will soon have to publish the release blog as a book.</p></blockquote>

Cilium ã¯æ´»ç™ºã«é–‹ç™ºãŒé€²ã‚ã‚‰ã‚Œã¦ãŠã‚Šã€ä»Šå›ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã¯ã‹ãªã‚Šè†¨å¤§ãªã‚‚ã®ã«ãªã£ã¦ã„ã¾ã™ã€‚
Ingress ã‚„ Service Mesh ãªã©ãŸãã•ã‚“ã®æ–°æ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€Cilium ã¯ãŸã ã® CNI å®Ÿè£…ã®ã²ã¨ã¤ã§ã¯ãªãã€å¤§ããªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ã‚ˆã†ã«æ€ãˆã¾ã™ã€‚

ä»Šå›ã¯ã€ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã®ä¸­ã‹ã‚‰ã„ãã¤ã‹æ°—ã«ãªã‚‹ã‚‚ã®ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã¿ã¾ã™ã€‚

- Sidecar-free datapath option: 
    - Istio ãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒƒã‚·ãƒ¥å®Ÿè£…ã§ã¯ã‚µã‚¤ãƒ‰ã‚«ãƒ¼æ–¹å¼ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€Cilium ã§ã¯ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãªã—æ–¹å¼ãŒã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦é¸ã¹ã‚‹ã‚ˆã†ã«ãªã£ãŸã¨ã®ã“ã¨ã€‚
    - å®Ÿè£…ã®è¤‡é›‘ã•ã‚„æ€§èƒ½é¢ã§ãã‚Œãã‚Œãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã€ã©ã¡ã‚‰ã®æ–¹å¼ãŒã‚ˆã„ã®ã‹è­°è«–ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ã€å°‘ã—æ§˜å­ã‚’è¦‹å®ˆã‚ŠãŸã„ã¨ã“ã‚ã§ã™ã€‚
- Egress Gateway promoted to Stable: 
    - Neco ãƒãƒ¼ãƒ ã¨ã—ã¦ã‚‚ Egress Gateway æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚ã—ã‹ã—ç¾çŠ¶ã¯ HA æ§‹æˆã§ã¯ãªã„ãŸã‚ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã§åˆ©ç”¨ã™ã‚‹ã®ã¯ã¡ã‚‡ã£ã¨é›£ã—ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
- Improved BGP control plane: 
    - IPv6 å¯¾å¿œã®ãŸã‚ã« MetalLB ã‹ã‚‰ GoBGP ã«ç½®ãæ›ãˆã¦ã„ãã“ã¨ã‚’æ±ºå®šã€‚
    - Neco ãƒãƒ¼ãƒ ã§ã¯ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã® VIP ã‚’åºƒå‘Šã™ã‚‹ãŸã‚ã« MetalLB ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãŒã€ãã“ã¯ã¾ã  GoBGP ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ãªã„æ¨¡æ§˜ã€‚ä»Šå¾Œ MetalLB ã‹ã‚‰ GoBGP ã¸ã®ç½®ãæ›ãˆãŒå¿…è¦ã«ãªã‚Šãã†ãªã®ã§è¦æ³¨ç›®ã€‚
- Improved Multi-Homing for Load Balancer: 
    - ã“ã‚Œã¾ã§è¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’æŒã¤ãƒãƒ¼ãƒ‰ã§æ­£ã—ãçµŒè·¯ãŒé¸æŠã•ã‚Œã¦ã„ãªã‹ã£ãŸãŒã“ã‚ŒãŒæ”¹å–„ã•ã‚ŒãŸã€‚ã“ã‚Œã¯ Neco ãƒãƒ¼ãƒ ãŒã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€Neco ãƒãƒ¼ãƒ ã§ã¯ç¾åœ¨ Cilium ã¸ã®ç§»è¡Œã‚’é€²ã‚ã¦ãŠã‚Šã€ãã®ä¸­ã§ã‹ãªã‚Šã®æ•°ã®ä¸å…·åˆã‚’è¦‹ã¤ã‘ã¦ã„ã¾ã™ã€‚
ä»Šå›ã®ãƒªãƒªãƒ¼ã‚¹ã§ã¯ã€ãªã‚“ã¨7ä»¶ã‚‚ã® PR ãŒå–ã‚Šè¾¼ã¾ã‚Œã¾ã—ãŸğŸ‰ğŸ‰ğŸ‰

- bgp: Check the Condition.Ready field when adding ready endpoints ([#20176](https://github.com/cilium/cilium/pull/20176), @ysksuzuki)
- daemon: Support the wildcard option for directRoutingDevice ([#17930](https://github.com/cilium/cilium/pull/17930), @ysksuzuki)
- bpf: Fix maglev hash with hostServices.hostNamespaceOnly ([#18336](https://github.com/cilium/cilium/pull/18336), @ysksuzuki)
- endpoint: Fix packets to host dropped with the chaining mode and host firewall ([#19734](https://github.com/cilium/cilium/pull/19734), @ysksuzuki)
- docs: Fix incorrect values for hubble-ui standalone install ([#18661](https://github.com/cilium/cilium/pull/18661), @ysksuzuki)
- neigh: Support multi device neighbor discovery (Backport PR [#20333](https://github.com/cilium/cilium/pull/20333), Upstream PR [#20092](https://github.com/cilium/cilium/pull/20092), @ysksuzuki)
- test: Fix make target for k8s tests (Backport PR [#20401](https://github.com/cilium/cilium/pull/20401), Upstream PR [#20264](https://github.com/cilium/cilium/pull/20264), @ysksuzuki)

## ğŸ‘€ Notable Articles

### Kubernetes ã® Gateway API ãŒ beta ã«

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://kubernetes.io/blog/2022/07/13/gateway-api-graduates-to-beta/">Kubernetes Gateway API Graduates to Beta</a></h4><p>Authors: Shane Utt (Kong), Rob Scott (Google), Nick Young (VMware), Jeff Apple (HashiCorp) We are excited to announce the v0.5.0 release of Gateway API. For the first time, several of our most important Gateway API resources are graduating to beta.</p></blockquote>

<blockquote class="embedly-card"><h4><a href="https://www.groundcover.com/blog/k8s-gateway-api">K8s Gateway API is here - what's in it for you?</a></h4><p>Yesterday (July 13th, 2022), the Kubernetes SIG-Network announced version 0.5.0 of the much anticipated Gateway API. What is so special about this release you ask? It's that finally, major components of the api are graduating to beta (v1beta1) - which means we will soon start to see more projects using those primitives - and they might even be good enough for the early adopters among us to give them a try.</p></blockquote>

Kubernetes ã® Ingress API ã®å¾Œç¶™ã¨ã—ã¦é–‹ç™ºãŒé€²ã‚ã‚‰ã‚Œã¦ã„ã‚‹ Gateway API ãŒã¤ã„ã«ãƒ™ãƒ¼ã‚¿ã¨ãªã‚Šã¾ã—ãŸã€‚

Gateway API ã¯ Ingress API ã¨æ¯”ã¹ã¦æ§˜ã€…ãªãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚

- ãƒªã‚½ãƒ¼ã‚¹ä½œæˆã®å½¹å‰²åˆ†æ‹…ãŒæ˜ç¢ºï¼ˆç®¡ç†è€…ãŒ Gateway/GatewayClass ã‚’ä½œæˆã—ã€ã‚¢ãƒ—ãƒªé–‹ç™ºè€…ãŒ HTTPRoute ã‚’ä½œæˆã™ã‚‹ãªã©ï¼‰
- Ingress ãƒªã‚½ãƒ¼ã‚¹ã¯è¡¨ç¾åŠ›ãŒä¹ã—ãè¨­å®šã‚’ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§æ›¸ãå¿…è¦ãŒã‚ã£ãŸãŒã€Gateway API ã§ã¯ãã¡ã‚“ã¨ API ã®è¨­è¨ˆãŒãŠã“ãªã‚ã‚Œã¦ã„ã‚‹ã€‚
- Namespace ã‚’ã¾ãŸãŒã£ãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šãŒå¯èƒ½

Neco ã§ã¯ L7LB ã¨ã—ã¦ [Contour](https://projectcontour.io) ã‚’æ¡ç”¨ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚¯ãƒ©ã‚¹ã‚¿å¤–ã«å…¬é–‹ã™ã‚‹ãŸã‚ã« [HTTPProxy](https://projectcontour.io/docs/v1.20.1/config/fundamentals/) ã¨ã„ã†ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

Contour ã¯ã™ã§ã« Gateway API ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

- [Using Gateway API (v1alpha2) with Contour](https://projectcontour.io/guides/gateway-api/)

ä»Šå¾Œã€HTTPProxy ã‹ã‚‰ Gateway API ã¸ã®ç½®ãæ›ãˆãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã‚„ã‚„æ°—ãŒé‡ãŸã„ã§ã™ã­ğŸ™

## ğŸ“˜ Books

### ãƒ”ã‚¢ãƒªãƒ³ã‚°æˆ¦è¨˜

Neco ãƒãƒ¼ãƒ ã§ã¯[ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å®Ÿè£…ã« BGP ã‚’åˆ©ç”¨](https://blog.cybozu.io/entry/bgp-basics)ã—ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã‚‚ã‚ã‚Šã€æœ€è¿‘è©±é¡Œã«ãªã£ã¦ã„ã‚‹ãƒ”ã‚¢ãƒªãƒ³ã‚°æˆ¦è¨˜ã‚’èª­ã‚“ã§ã¿ã¾ã—ãŸã€‚

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://www.lambdanote.com/products/peering">ãƒ”ã‚¢ãƒªãƒ³ã‚°æˆ¦è¨˜ â€• æ—¥æœ¬ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ç¹‹ãæŠ€è¡“è€…ãŸã¡</a></h4><p>ã€Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ã£ã¦ã€ã“ã†ã„ã†æ„å‘³ã ã£ãŸã‚“ã ï¼ æŠ€è¡“çš„ãªä»•æ§˜ã®è§£èª¬ã ã‘ã§ã¯èªã‚Œãªã„ã€äººã¨äººã‚’ç¹‹ããƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŠ€è¡“ã ã‹ã‚‰ã“ãç«‹ã¡ç¾ã‚Œã‚‹ç”Ÿã€…ã—ã„èˆå°è£ã‚’ã€2020å¹´ä»£ã®æ—¥æœ¬ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®å¤§è¦æ¨¡æ§‹é€ ã«å½±éŸ¿ã‚’ã‚‚ãŸã‚‰ã—ãŸå½“äº‹è€…ãŸã¡ã¸ã®å–æã¨ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚’ã¨ãŠã—ã¦è§£ãæ˜ã‹ã™ï¼ å°å·æ™ƒé€š è‘— 150ãƒšãƒ¼ã‚¸ A5åˆ¤ 2022å¹´7æœˆ13æ—¥ ç™ºè¡Œ ç¬¬1ç«  ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’å·¡ã‚‹é™ã‹ãªæˆ¦ã„ ç¬¬2ç«  ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã¨ãã®ç«‹åœ° ç¬¬3ç«  IXã¨ã¯ä½•ã‹? å›½ã”ã¨ã«é•ã†IX ç¬¬4ç«  ãƒ”ã‚¢ãƒªãƒ³ã‚°ç›¸æ‰‹ã®æ¢ã—æ–¹ ç¬¬5ç«  ã‚³ãƒ³ãƒ†ãƒ³ãƒ„äº‹æ¥­è€…ã®å°é ­</p></blockquote>

æ—¥æœ¬ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒã©ã®ã‚ˆã†ã«æ§‹ç¯‰ã•ã‚Œã¦ããŸã®ã‹ã¨ã„ã†æ­´å²ã‚’ã€ãŸãã•ã‚“ã®ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚’é€šã˜ã¦çŸ¥ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨ã¦ã‚‚é¢ç™½ã„ä¸€å†Šã§ã—ãŸã€‚

## ğŸ› ï¸ Frameworks, Libraries

### Connect: A better gRPC

<blockquote class="embedly-card" data-card-controls="0"><h4><a href="https://buf.build/blog/connect-a-better-grpc">Connect: A better gRPC</a></h4><p>Today we're releasing Connect, a slim framework for building browser and gRPC-compatible HTTP APIs. Connect is production-ready - focused, simple, and debuggable - and it's fully compatible with gRPC clients and servers. If you're frustrated by the complexity and instability of today's gRPC libraries, we think you'll find Connect a breath of fresh air.</p></blockquote>

ã“ã‚Œã¾ã§åºƒãä½¿ã‚ã‚Œã¦ããŸ gRPC ã® Go å®Ÿè£…ã¯ [grpc-go](https://github.com/grpc/grpc-go) ã§ã™ã€‚
grpc-go ã¯è‡ªå‰ã§ HTTP/2 ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ãŸã‚ Go ã® HTTP ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ããªã‹ã£ãŸã‚Šã€JavaScript ã‹ã‚‰ gRPC ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³å‡ºã™ãŸã‚ã«ãƒ—ãƒ­ã‚­ã‚·ãŒå¿…è¦ã ã£ãŸã‚Šã€ã„ãã¤ã‹ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

ãã‚Œã‚‰ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã« Connect ã¨ã„ã†æ–°ã—ã„ gRPC ã®å®Ÿè£…ãŒç™»å ´ã—ãŸã‚ˆã†ã§ã™ã€‚

Connect ã¯ç¾åœ¨ãƒ™ãƒ¼ã‚¿ç‰ˆã¨ã®ã“ã¨ã§ã™ãŒã€2022å¹´10æœˆã«ã¯å®‰å®šç‰ˆã®ãƒªãƒªãƒ¼ã‚¹ãŒäºˆå®šã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
ä»Šå¾Œã¯ gRPC å®Ÿè£…ã®ä¸€ã¤ã®é¸æŠè‚¢ã¨ã—ã¦æ¤œè¨ã—ã¦ã¿ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ã€‚

ãªãŠã€Neco ãƒãƒ¼ãƒ ã§ã¯ [MOCO](https://github.com/cybozu-go/moco) ã‚„ [Coil](https://github.com/cybozu-go/coil) ã®å®Ÿè£…ã§ gRPC ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚

gRPC ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ã€ãœã²ä»¥ä¸‹ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚‚ã”è¦§ãã ã•ã„ã€‚

- [gRPC ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://github.com/ymmt2005/grpc-tutorial)

## ãŠã‚ã‚Šã«

Neco Weekly ã®å–ã‚Šçµ„ã¿ã¯ [Cybozu Frontend Weekly](https://cybozu.github.io/frontend-expert/posts), [Productivity Weekly](https://zenn.dev/topics/productivityweekly) ã‚’å‚è€ƒã«ã—ã¦å§‹ã‚ã¾ã—ãŸã€‚

Cybozu Frontend Weekly ã‚„ Productivity Weekly ã¨åŒã˜æ§˜ã«ã€é•·ãç¶šã‘ã¦ã„ã‘ã‚Œã°ã„ã„ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚
